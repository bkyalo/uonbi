define(["jquery","core/ajax","core/templates","core/notification"],function(a,b,c,d){return{observer:null,registerObserver:function(){this.observer=new MutationObserver(function(a,b){b.newcourses=[],b.hascourses=!1;for(var c=0;c<a.length;c++)if(a[c].addedNodes)for(var d=0;d<a[c].addedNodes.length;d++)if(a[c].addedNodes[d].querySelectorAll){var e=a[c].addedNodes[d].querySelectorAll("[data-overview-course-id]");if(e&&e.length)for(var f=0;f<e.length;f++){var g=e[f].dataset.overviewCourseId;b.hascourses=!0,b.cache.hasOwnProperty(g)||b.newcourses.push(g)}}b.newcourses.length>0?b.fetchCourses(b.newcourses):b.hascourses&&b.updateCourses()}),this.observer.cache={},this.observer.selector=document.querySelector("#block-region-content .block_myoverview"),this.observer.selector&&(this.observer.fetchCourses=this.fetchCourses.bind(this.observer),this.observer.updateCourses=this.updateCourses.bind(this.observer),this.observer.observe(this.observer.selector,{childList:!0,subtree:!0}))},init:function(){this.registerObserver()},fetchCourses:function(a){var c=function(a){a.forEach(function(a){this.cache[a.id]=a},this),this.updateCourses()};b.call([{methodname:"theme_uonbi_course_metadata",args:{courses:a.join(",")},done:c.bind(this),fail:function(a){throw a.error}}])},updateCourses:function(){this.disconnect();var b=[],e=function(a,b){c.render("block_myoverview/cards-buttons",this.cache[a]).then(function(a,d){return c.replaceNodeContents(b,a,d)})}.bind(this),f=function(a,b){b.children().remove(),b.append(this.cache[a].summary)}.bind(this);for(var g in this.cache)if(this.cache.hasOwnProperty(g)){var h=a("#block-region-content .block_myoverview [data-overview-course-id="+g+"] .summary-icons");0!=h.length&&b.push(e(g,h));var i=a("#course-summary-"+g);0!=i.children().length&&b.push(f(g,i))}var j=function(){this.observe(this.selector,{childList:!0,subtree:!0})}.bind(this);Promise.all(b).then(function(){j()})["catch"](d.exception)}}});